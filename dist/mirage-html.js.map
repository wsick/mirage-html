{"version":3,"sources":["_version.ts","AnimClock.ts","Binder.ts","BinderRegistry.ts","DOMMonitor.ts","DraftUpdater.ts","ElementTranslator.ts","global.ts","Orchestrator.ts","PanelInserter.ts","TreeSynchronizer.ts","TreeTracker.ts"],"names":["mirage","mirage.html","mirage.html.NewAnimClock","mirage.html.NewAnimClock.tick","mirage.html.NewAnimClock.enable","mirage.html.NewAnimClock.disable","mirage.html.NewBinder","mirage.html.NewBinder.getRootSize","mirage.html.NewBinder.getRoot","mirage.html.NewBinder.setRoot","mirage.html.NewBinder.run","mirage.html.NewBinderRegistry","mirage.html.NewBinderRegistry.hoist","mirage.html.NewBinderRegistry.findRoot","mirage.html.NewBinderRegistry.replaceBinderRoot","mirage.html.NewBinderRegistry.create","mirage.html.NewBinderRegistry.destroy","mirage.html.NewBinderRegistry.destroyBinder","mirage.html.NewBinderRegistry.update","mirage.html.isMirageElement","mirage.html.NewDOMMonitor","mirage.html.NewDOMMonitor.start","mirage.html.NewDOMMonitor.stop","mirage.html.NewDraftUpdater","mirage.html.NewDraftUpdater.updateSlot","mirage.html.NewDraftUpdater.updateSlots","mirage.html.NewElementTranslator","mirage.html.NewElementTranslator.parseDataLayout","mirage.html.NewElementTranslator.applyHash","mirage.html.NewElementTranslator.translateNew","mirage.html.NewElementTranslator.translateChange","mirage.watchDOM","mirage.getRoots","mirage.getLayoutNode","mirage.dumpLayoutTree","mirage.enableConsoleLogger","mirage.html.NewOrchestrator","mirage.html.NewOrchestrator.onFrame","mirage.html.NewOrchestrator.start","mirage.html.NewOrchestrator.stop","mirage.html.NewPanelInserter","mirage.html.NewPanelInserter.add","mirage.html.NewPanelInserter.commit","mirage.html.NewTreeSynchronizer","mirage.html.NewTreeSynchronizer.mirrorAdded","mirage.html.NewTreeSynchronizer.mirrorUntagged","mirage.html.NewTreeSynchronizer.mirrorRemoved","mirage.html.NewTreeSynchronizer.register","mirage.html.NewTreeSynchronizer.deregister","mirage.html.NewTreeSynchronizer.promoteChildren","mirage.html.NewTreeSynchronizer.mirrorTranslations","mirage.html.NewTreeSynchronizer.replaceNode","mirage.html.NewTreeSynchronizer.mirrorAncestry","mirage.html.NewTreeSynchronizer.configAncestors","mirage.html.NewTreeSynchronizer.update","mirage.html.NewTreeSynchronizer.init","mirage.html.NewTreeSynchronizer.scan","mirage.html.NewTreeSynchronizer.start","mirage.html.NewTreeSynchronizer.stop","mirage.html.NewTreeTracker","mirage.html.NewTreeTracker.add","mirage.html.NewTreeTracker.replaceNode","mirage.html.NewTreeTracker.removeElement","mirage.html.NewTreeTracker.elementExists","mirage.html.NewTreeTracker.getNodeByElement","mirage.html.NewTreeTracker.getElementByNode","mirage.html.getNodeUid"],"mappings":"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AAKA,WAAWA,CAACA,CAACA,CAACA;wBAChCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,QAAQA,CAACA,UAAUA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;4BAClDA,IAAIA,EAAEA,GAAGA,QAAQA,CAACA,UAAUA,CAACA,CAACA,CAACA,CAACA;4BAChCA,EAAEA,CAACA,CAACA,eAAeA,CAACA,EAAEA,CAACA,CAACA,CAACA,CAACA;gCACtBA,KAAKA,CAACA,IAAIA,CAAUA,EAAEA,CAACA,CAACA;gCACxBA,WAAWA,GAAGA,IAAIA,CAACA;4BACvBA,CAACA;wBACLA,CAACA;wBACDA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,QAAQA,CAACA,YAAYA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;4BACpDA,IAAIA,EAAEA,GAAGA,QAAQA,CAACA,YAAYA,CAACA,CAACA,CAACA,CAACA;4BAClCA,EAAEA,CAACA,CAACA,eAAeA,CAACA,EAAEA,CAACA,CAACA,CAACA,CAACA;gCACtBA,OAAOA,CAACA,IAAIA,CAAUA,EAAEA,CAACA,CAACA;gCAC1BA,WAAWA,GAAGA,IAAIA,CAACA;4BACvBA,CAACA;wBACLA,CAACA;oBACLA,CAACA;oBAACA,IAAIA,CAACA,EAAEA,CAACA,CAACA,QAAQA,CAACA,IAAIA,KAAKA,YAAYA,CAACA,CAACA,CAACA;wBACxCA,EAAEA,CAACA,CAACA,CAACA,QAAQA,CAACA,QAAQA,CAACA,CAACA,CAACA;4BACrBA,EAAEA,CAACA,CAACA,eAAeA,CAACA,QAAQA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA;gCAEnCA,KAAKA,CAACA,IAAIA,CAAUA,QAAQA,CAACA,MAAMA,CAACA,CAACA;gCACrCA,WAAWA,GAAGA,IAAIA,CAACA;4BACvBA,CAACA;wBACLA,CAACA;wBAACA,IAAIA,CAACA,CAACA;4BACJA,EAAEA,CAACA,CAACA,CAACA,eAAeA,CAACA,QAAQA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA;gCAEpCA,QAAQA,CAACA,IAAIA,CAAUA,QAAQA,CAACA,MAAMA,CAACA,CAACA;gCACxCA,WAAWA,GAAGA,IAAIA,CAACA;4BACvBA,CAACA;4BAACA,IAAIA,CAACA,CAACA;gCAEJA,OAAOA,CAACA,IAAIA,CAACA,EAACA,MAAMA,EAAWA,QAAQA,CAACA,MAAMA,EAAEA,QAAQA,EAAEA,QAAQA,CAACA,QAAQA,EAACA,CAACA,CAACA;gCAC9EA,WAAWA,GAAGA,IAAIA,CAACA;4BACvBA,CAACA;wBACLA,CAACA;oBACLA,CAACA;gBACLA,CAACA;gBAEDA,EAAEA,CAACA,CAACA,WAAWA,CAACA,CAACA,CAACA;oBACdA,QAAQA,CAACA,KAAKA,EAAEA,OAAOA,EAAEA,QAAQA,EAAEA,OAAOA,CAACA,CAACA;gBAChDA,CAACA;YACLA,CAACA,CAACA,CAACA;YAEHA,MAAMA,CAACA;gBACHA,KAAKA;oBACDC,QAAQA,CAACA,OAAOA,CAACA,MAAMA,EAAEA;wBACrBA,SAASA,EAAEA,IAAIA;wBACfA,OAAOA,EAAEA,IAAIA;wBACbA,UAAUA,EAAEA,IAAIA;wBAChBA,iBAAiBA,EAAEA,IAAIA;wBACvBA,eAAeA,EAAEA,CAACA,aAAaA,CAACA;qBACnCA,CAACA,CAACA;gBACPA,CAACA;gBACDD,IAAIA;oBACAE,QAAQA,CAACA,UAAUA,EAAEA,CAACA;gBAC1BA,CAACA;aACJF,CAACA;QACNA,CAACA;QAjEenB,kBAAaA,gBAiE5BA,CAAAA;IACLA,CAACA,EA/FgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QA+FpBA;AAADA,CAACA,EA/FS,MAAM,KAAN,MAAM,QA+Ff;AC/FD,IAAU,MAAM,CAsBf;AAtBD,WAAU,MAAM;IAACA,IAAAA,IAAIA,CAsBpBA;IAtBgBA,WAAAA,IAAIA,EAACA,CAACA;QACnBC,yBAAgCA,IAAkBA;YAC9CsB,oBAAoBA,EAAeA,EAAEA,IAAWA;gBAC5CC,EAAEA,CAACA,KAAKA,CAACA,QAAQA,GAAGA,UAAUA,CAACA;gBAC/BA,EAAEA,CAACA,KAAKA,CAACA,IAAIA,GAAMA,IAAIA,CAACA,CAACA,OAAIA,CAACA;gBAC9BA,EAAEA,CAACA,KAAKA,CAACA,GAAGA,GAAMA,IAAIA,CAACA,CAACA,OAAIA,CAACA;gBAC7BA,EAAEA,CAACA,KAAKA,CAACA,KAAKA,GAAMA,IAAIA,CAACA,KAAKA,OAAIA,CAACA;gBACnCA,EAAEA,CAACA,KAAKA,CAACA,MAAMA,GAAMA,IAAIA,CAACA,MAAMA,OAAIA,CAACA;YACzCA,CAACA;YAEDD,MAAMA,CAACA;gBACHA,WAAWA,YAACA,OAA4BA;oBACpCE,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;wBACtCA,IAAIA,MAAMA,GAAGA,OAAOA,CAACA,CAACA,CAACA,CAACA;wBACxBA,IAAIA,IAAIA,GAAGA,MAAMA,CAACA,IAAIA,CAACA;wBACvBA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,IAAIA,CAACA,MAAMA,CAACA;4BAClBA,QAAQA,CAACA;wBACbA,UAAUA,CAAcA,IAAIA,CAACA,gBAAgBA,CAACA,MAAMA,CAACA,IAAIA,CAACA,EAAEA,MAAMA,CAACA,OAAOA,CAACA,CAACA;oBAChFA,CAACA;gBACLA,CAACA;aACJF,CAACA;QACNA,CAACA;QApBetB,oBAAeA,kBAoB9BA,CAAAA;IACLA,CAACA,EAtBgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QAsBpBA;AAADA,CAACA,EAtBS,MAAM,KAAN,MAAM,QAsBf;ACtBD,IAAU,MAAM,CA4Ef;AA5ED,WAAU,MAAM;IAACA,IAAAA,IAAIA,CA4EpBA;IA5EgBA,WAAAA,IAAIA,EAACA,CAACA;QAenBC;YACIyB,yBAAyBA,UAAkBA;gBACvCC,IAAIA,IAAIA,GAAoBA,EAAEA,CAACA;gBAC/BA,GAAGA,CAACA,CAACA,GAAGA,CAACA,MAAMA,GAAGA,UAAUA,CAACA,KAAKA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,MAAMA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACrEA,IAAIA,KAAKA,GAAGA,MAAMA,CAACA,CAACA,CAACA,CAACA;oBACtBA,IAAIA,KAAKA,GAAGA,KAAKA,CAACA,OAAOA,CAACA,GAAGA,CAACA,CAACA;oBAC/BA,EAAEA,CAACA,CAACA,KAAKA,GAAGA,CAACA,CAACA;wBACVA,QAAQA,CAACA;oBACbA,IAAIA,CAACA,KAAKA,CAACA,MAAMA,CAACA,CAACA,EAAEA,KAAKA,CAACA,CAACA,IAAIA,EAAEA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,CAACA,KAAKA,GAAGA,CAACA,CAACA,CAACA,IAAIA,EAAEA,CAACA;gBACzEA,CAACA;gBACDA,MAAMA,CAACA,IAAIA,CAACA;YAChBA,CAACA;YAEDD,mBAAmBA,IAAqBA,EAAEA,IAAqBA;gBAC3DE,GAAGA,CAACA,CAACA,GAAGA,CAACA,IAAIA,GAAGA,MAAMA,CAACA,IAAIA,CAACA,IAAIA,CAACA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,IAAIA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBAC7DA,IAAIA,GAAGA,GAAGA,IAAIA,CAACA,CAACA,CAACA,CAACA;oBAClBA,IAAIA,MAAMA,GAAGA,MAAMA,CAACA,GAAGA,CAACA,SAASA,CAACA,GAAGA,CAACA,CAACA;oBACvCA,EAAEA,CAACA,CAACA,MAAMA,CAACA;wBACPA,MAAMA,CAACA,IAAIA,EAAEA,IAAIA,CAACA,GAAGA,CAACA,CAACA,CAACA;gBAChCA,CAACA;YACLA,CAACA;YAEDF,MAAMA,CAACA;gBACHA,YAAYA,YAACA,EAAWA;oBACpBG,IAAIA,IAAIA,GAAGA,eAAeA,CAACA,EAAEA,CAACA,YAAYA,CAACA,aAAaA,CAACA,CAACA,CAACA;oBAC3DA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA,MAAMA,CAACA,CAACA;oBACxBA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA;wBACNA,MAAMA,CAACA,IAAIA,CAACA;oBAChBA,IAAIA,IAAIA,GAAGA,MAAMA,CAACA,gBAAgBA,CAACA,IAAIA,CAACA,CAACA;oBACzCA,SAASA,CAACA,IAAIA,EAAEA,IAAIA,CAACA,CAACA;oBACtBA,MAAMA,CAACA,IAAIA,CAACA;gBAChBA,CAACA;gBACDH,eAAeA,YAACA,EAAWA,EAAEA,IAAqBA,EAAEA,aAAqBA;oBACrEI,IAAIA,OAAOA,GAAGA,eAAeA,CAACA,aAAaA,CAACA,CAACA;oBAC7CA,IAAIA,OAAOA,GAAGA,eAAeA,CAACA,EAAEA,CAACA,YAAYA,CAACA,aAAaA,CAACA,CAACA,CAACA;oBAC9DA,IAAIA,OAAOA,GAAGA,OAAOA,CAACA,MAAMA,CAACA,CAACA;oBAC9BA,EAAEA,CAACA,CAACA,CAACA,OAAOA,CAACA;wBACTA,MAAMA,CAACA,IAAIA,CAACA;oBAChBA,EAAEA,CAACA,CAACA,OAAOA,CAACA,MAAMA,CAACA,KAAKA,OAAOA,CAACA,CAACA,CAACA;wBAC9BA,IAAIA,OAAOA,GAAGA,MAAMA,CAACA,gBAAgBA,CAACA,OAAOA,CAACA,CAACA;wBAC/CA,SAASA,CAACA,OAAOA,EAAEA,OAAOA,CAACA,CAACA;wBAC5BA,MAAMA,CAACA,OAAOA,CAACA;oBACnBA,CAACA;oBAGDA,IAAIA,OAAOA,GAAGA,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAACA;oBACnCA,IAAIA,OAAOA,GAAGA,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAACA;oBACnCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;wBACtCA,IAAIA,GAAGA,GAAGA,OAAOA,CAACA,CAACA,CAACA,CAACA;wBACrBA,EAAEA,CAACA,CAACA,OAAOA,CAACA,OAAOA,CAACA,GAAGA,CAACA,GAAGA,CAACA,CAACA,CAACA;4BAC1BA,QAAQA,CAACA;wBACbA,IAAIA,MAAMA,GAAGA,MAAMA,CAACA,GAAGA,CAACA,SAASA,CAACA,GAAGA,CAACA,CAACA;wBACvCA,EAAEA,CAACA,CAACA,MAAMA,CAACA;4BACPA,MAAMA,CAACA,IAAIA,EAAEA,SAASA,CAACA,CAACA;oBAChCA,CAACA;oBAEDA,SAASA,CAACA,IAAIA,EAAEA,OAAOA,CAACA,CAACA;oBACzBA,MAAMA,CAACA,IAAIA,CAACA;gBAChBA,CAACA;aACJJ,CAACA;QACNA,CAACA;QA5DezB,yBAAoBA,uBA4DnCA,CAAAA;IACLA,CAACA,EA5EgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QA4EpBA;AAADA,CAACA,EA5ES,MAAM,KAAN,MAAM,QA4Ef;AC5ED,IAAU,MAAM,CA6Cf;AA7CD,WAAU,MAAM,EAAC,CAAC;IACdA,IAAIA,YAAgCA,CAACA;IAErCA,kBAAyBA,MAAaA;QAClC+B,MAAMA,GAAGA,MAAMA,IAAIA,QAAQA,CAACA,IAAIA,CAACA;QACjCA,YAAYA,GAAGA,WAAIA,CAACA,eAAeA,CAACA,MAAMA,CAACA,CAACA;QAC5CA,YAAYA,CAACA,KAAKA,EAAEA,CAACA;IACzBA,CAACA;IAJe/B,eAAQA,WAIvBA,CAAAA;IAEDA;QACIgC,MAAMA,CAACA,YAAYA,CAACA,OAAOA,CAACA,GAAGA,CAACA,UAAAA,MAAMA,IAAIA,OAAAA,MAAMA,CAACA,OAAOA,EAAEA,EAAhBA,CAAgBA,CAACA,CAACA;IAChEA,CAACA;IAFehC,eAAQA,WAEvBA,CAAAA;IAEDA,uBAA8BA,GAAqBA;QAC/CiC,IAAIA,EAAWA,CAACA;QAChBA,EAAEA,CAACA,CAACA,OAAOA,GAAGA,KAAKA,QAAQA,CAACA,CAACA,CAACA;YAC1BA,EAAEA,GAAGA,QAAQA,CAACA,cAAcA,CAACA,GAAGA,CAACA,CAACA;QACtCA,CAACA;QAACA,IAAIA,CAACA,CAACA;YACJA,EAAEA,GAAGA,GAAGA,CAACA;QACbA,CAACA;QACDA,MAAMA,CAACA,EAAEA,GAAGA,YAAYA,CAACA,IAAIA,CAACA,gBAAgBA,CAACA,EAAEA,CAACA,GAAGA,IAAIA,CAACA;IAC9DA,CAACA;IARejC,oBAAaA,gBAQ5BA,CAAAA;IAEDA,wBAA+BA,IAAqBA,EAAEA,MAAeA;QACjEkC,IAAIA,CAACA,GAAGA,EAAEA,CAACA;QACXA,EAAEA,CAACA,CAACA,CAACA,MAAMA,CAACA,CAACA,CAACA;YACVA,CAACA,IAAIA,IAAIA,CAACA;YACVA,MAAMA,GAAGA,EAAEA,CAACA;QAChBA,CAACA;QACDA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA,WAAWA,CAACA;QAC5BA,CAACA,IAAIA,MAAMA,GAASA,IAAKA,CAACA,IAAIA,CAACA,QAAQA,EAAEA,GAAGA,IAAIA,CAACA;QACjDA,GAAGA,CAACA,CAACA,GAAGA,CAACA,MAAMA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,IAAIA,EAAEA,EAAEA,MAAMA,CAACA,IAAIA,EAAEA,GAAGA,CAACA;YACjDA,CAACA,IAAIA,cAAcA,CAACA,MAAMA,CAACA,OAAOA,EAAEA,MAAMA,GAAGA,IAAIA,CAACA,CAACA;QACvDA,CAACA;QACDA,MAAMA,CAACA,CAACA,CAACA;IACbA,CAACA;IAZelC,qBAAcA,iBAY7BA,CAAAA;IAEDA;QACImC,MAAMA,CAACA,MAAMA,GAAGA,MAAMA,CAACA,OAAOA,CAACA,gBAAgBA,CAACA,UAAAA,IAAIA;YAChDA,IAAIA,EAAEA,GAAGA,YAAYA,CAACA,IAAIA,CAACA,gBAAgBA,CAACA,IAAIA,CAACA,CAACA;YAClDA,IAAIA,EAAEA,GAAGA,EAAEA,IAAIA,EAAEA,CAACA,EAAEA,GAAGA,MAAIA,EAAEA,CAACA,EAAIA,GAAGA,EAAEA,CAACA;YACxCA,IAAIA,IAAIA,GAAQA,IAAIA,CAACA,WAAWA,CAACA;YACjCA,MAAMA,CAACA,KAAGA,IAAIA,CAACA,IAAIA,GAAGA,EAAIA,CAACA;QAC/BA,CAACA,CAACA,CAACA;IACPA,CAACA;IAPenC,0BAAmBA,sBAOlCA,CAAAA;AACLA,CAACA,EA7CS,MAAM,KAAN,MAAM,QA6Cf;AC7CD,IAAU,MAAM,CAsCf;AAtCD,WAAU,MAAM;IAACA,IAAAA,IAAIA,CAsCpBA;IAtCgBA,WAAAA,IAAIA,EAACA,CAACA;QAUnBC,yBAAgCA,MAAYA;YACxCmC,IAAIA,IAAIA,GAAGA,mBAAcA,EAAEA,CAACA;YAC5BA,IAAIA,OAAOA,GAAcA,EAAEA,CAACA;YAC5BA,IAAIA,QAAQA,GAAGA,sBAAiBA,CAACA,IAAIA,EAAEA,OAAOA,CAACA,CAACA;YAChDA,IAAIA,IAAIA,GAAGA,wBAAmBA,CAACA,MAAMA,EAAEA,IAAIA,EAAEA,QAAQA,CAACA,CAACA;YACvDA,IAAIA,KAAKA,GAAGA,iBAAYA,CAACA,OAAOA,CAACA,CAACA;YAElCA,iBAAiBA,GAAWA,EAAEA,KAAaA;gBACvCC,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACtCA,OAAOA,CAACA,CAACA,CAACA,CAACA,GAAGA,EAAEA,CAACA;gBACrBA,CAACA;YACLA,CAACA;YAEDD,MAAMA,CAACA;gBACHA,IAAIA,EAAEA,IAAIA;gBACVA,OAAOA,EAAEA,OAAOA;gBAChBA,QAAQA,EAAEA,QAAQA;gBAClBA,IAAIA,EAAEA,IAAIA;gBACVA,KAAKA;oBACDE,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;oBACjBA,KAAKA,CAACA,MAAMA,EAAEA,CAACA;gBACnBA,CAACA;gBACDF,IAAIA;oBACAG,KAAKA,CAACA,OAAOA,EAAEA,CAACA;oBAChBA,IAAIA,CAACA,IAAIA,EAAEA,CAACA;gBAChBA,CAACA;aACJH,CAACA;QACNA,CAACA;QA3BenC,oBAAeA,kBA2B9BA,CAAAA;IACLA,CAACA,EAtCgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QAsCpBA;AAADA,CAACA,EAtCS,MAAM,KAAN,MAAM,QAsCf;ACtCD,IAAU,MAAM,CA6Df;AA7DD,WAAU,MAAM;IAACA,IAAAA,IAAIA,CA6DpBA;IA7DgBA,WAAAA,IAAIA,EAACA,CAACA;QAqBnBC;YACIuC,IAAIA,KAAKA,GAAuBA,EAAEA,CAACA;YAEnCA,MAAMA,CAACA;gBACHA,GAAGA,YAACA,KAAYA,EAAEA,EAAWA,EAAEA,IAAqBA;oBAChDC,IAAIA,IAAIA,GAAGA,KAAKA,CAACA,WAAWA,CAACA,kBAAkBA,CAACA,CAACA;oBACjDA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA;wBACRA,IAAIA,GAAGA;4BACHA,KAAKA,EAAEA,KAAKA;4BACZA,OAAOA,EAAEA,EAAEA;yBACdA,CAACA;wBACFA,KAAKA,CAACA,WAAWA,CAACA,kBAAkBA,EAAEA,IAAIA,CAACA,CAACA;wBAC5CA,KAAKA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA;oBACrBA,CAACA;oBAEDA,IAAIA,CAACA,OAAOA,CAACA,IAAIA,CAACA;wBACdA,IAAIA,EAAEA,IAAIA;wBACVA,KAAKA,EAAEA,KAAKA,CAACA,SAASA,CAACA,OAAOA,CAACA,IAAIA,CAACA,EAAEA,CAACA,aAAaA,CAACA,QAAQA,EAAEA,EAAEA,CAACA;qBACrEA,CAACA,CAACA;gBACPA,CAACA;gBACDD,MAAMA;oBACFE,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;wBACpCA,IAAIA,IAAIA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA;wBACpBA,IAAIA,KAAKA,GAAGA,IAAIA,CAACA,KAAKA,CAACA;wBACvBA,IAAIA,OAAOA,GAAGA,IAAIA,CAACA,OAAOA,CAACA;wBAC3BA,KAAKA,CAACA,WAAWA,CAACA,kBAAkBA,EAAEA,SAASA,CAACA,CAACA;wBACjDA,OAAOA,CAACA,IAAIA,CAACA,UAACA,CAACA,EAAEA,CAACA,IAAKA,OAAAA,CAACA,CAACA,KAAKA,GAAGA,CAACA,CAACA,KAAKA,EAAjBA,CAAiBA,CAACA,CAACA;wBAC1CA,IAAIA,QAAQA,GAAsBA,EAAEA,CAACA;wBACrCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;4BACtCA,IAAIA,KAAKA,GAAGA,OAAOA,CAACA,CAACA,CAACA,CAACA;4BAEvBA,EAAEA,CAACA,CAACA,QAAQA,CAACA,OAAOA,CAACA,KAAKA,CAACA,IAAIA,CAACA,GAAGA,CAACA,CAACA,CAACA;gCAClCA,QAAQA,CAACA;4BACbA,QAAQA,CAACA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BAC1BA,KAAKA,CAACA,WAAWA,CAACA,KAAKA,CAACA,IAAIA,EAAEA,KAAKA,CAACA,KAAKA,CAACA,CAACA;wBAC/CA,CAACA;oBACLA,CAACA;gBACLA,CAACA;aACJF,CAACA;QACNA,CAACA;QAvCevC,qBAAgBA,mBAuC/BA,CAAAA;IACLA,CAACA,EA7DgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QA6DpBA;AAADA,CAACA,EA7DS,MAAM,KAAN,MAAM,QA6Df;AC7DD,IAAU,MAAM,CAkOf;AAlOD,WAAU,MAAM;IAACA,IAAAA,IAAIA,CAkOpBA;IAlOgBA,WAAAA,IAAIA,EAACA,CAACA;QAYnBC,6BAAoCA,MAAYA,EAAEA,IAAmBA,EAAEA,QAA0BA,EAAEA,UAA+BA;YAC9H0C,IAAIA,GAAGA,IAAIA,IAAIA,mBAAcA,EAAEA,CAACA;YAChCA,QAAQA,GAAGA,QAAQA,IAAIA,sBAAiBA,CAACA,IAAIA,CAACA,CAACA;YAC/CA,UAAUA,GAAGA,UAAUA,IAAIA,yBAAoBA,EAAEA,CAACA;YAElDA,qBAAqBA,KAAgBA;gBAEjCC,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACpCA,QAAQA,CAACA,KAAKA,CAACA,CAACA,CAACA,CAACA,CAACA;gBACvBA,CAACA;YACLA,CAACA;YAEDD,wBAAwBA,QAAmBA,EAAEA,UAA6BA,EAAEA,cAAiCA;gBAEzGE,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,QAAQA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACvCA,UAAUA,CAACA,QAAQA,CAACA,CAACA,CAACA,EAAEA,IAAIA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;gBAC9DA,CAACA;YACLA,CAACA;YAEDF,uBAAuBA,OAAkBA,EAAEA,UAA6BA,EAAEA,cAAiCA;gBAIvGG,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACtCA,UAAUA,CAACA,OAAOA,CAACA,CAACA,CAACA,EAAEA,KAAKA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;gBAC9DA,CAACA;YACLA,CAACA;YAEDH,kBAAkBA,EAAWA;gBACzBI,EAAEA,CAACA,CAACA,IAAIA,CAACA,aAAaA,CAACA,EAAEA,CAACA,IAAIA,CAACA,oBAAeA,CAACA,EAAEA,CAACA,CAACA;oBAC/CA,MAAMA,CAACA;gBAGXA,IAAIA,IAAIA,GAAGA,UAAUA,CAACA,YAAYA,CAACA,EAAEA,CAACA,CAACA;gBACvCA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA;oBAERA,MAAMA,CAACA;gBACXA,CAACA;gBACDA,IAAIA,CAACA,GAAGA,CAACA,EAAEA,EAAEA,IAAIA,CAACA,CAACA;gBAGnBA,GAAGA,CAACA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,EAAEA,CAACA,iBAAiBA,EAAEA,CAACA,CAACA,GAAGA,EAAEA,GAAGA,GAAGA,GAAGA,CAACA,kBAAkBA,EAAEA,CAACA;oBACvEA,QAAQA,CAACA,GAAGA,CAACA,CAACA;gBAClBA,CAACA;YACLA,CAACA;YAEDJ,oBAAoBA,EAAWA,EAAEA,UAAmBA,EAAEA,UAA6BA,EAAEA,cAAiCA;gBAClHK,IAAIA,IAAIA,GAAGA,IAAIA,CAACA,aAAaA,CAACA,EAAEA,CAACA,CAACA;gBAClCA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA;oBACNA,MAAMA,CAACA;gBACXA,EAAEA,CAACA,CAACA,CAACA,UAAUA,CAACA,CAACA,CAACA;oBAEdA,GAAGA,CAACA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,EAAEA,CAACA,iBAAiBA,EAAEA,CAACA,CAACA,GAAGA,EAAEA,GAAGA,GAAGA,GAAGA,CAACA,kBAAkBA,EAAEA,CAACA;wBACvEA,UAAUA,CAACA,GAAGA,EAAEA,IAAIA,EAAEA,IAAIA,EAAEA,IAAIA,CAACA,CAACA;oBACtCA,CAACA;gBACLA,CAACA;gBAEDA,IAAIA,UAAUA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,MAAMA,CAACA;gBAClCA,EAAEA,CAACA,CAACA,CAACA,UAAUA,CAACA,CAACA,CAACA;oBACdA,cAAcA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA;oBAC1BA,eAAeA,CAACA,EAAEA,EAAEA,UAAUA,CAACA,CAACA;gBACpCA,CAACA;gBAEDA,EAAEA,CAACA,CAACA,UAAUA,YAAYA,YAAKA,CAACA,CAACA,CAACA;oBAC9BA,UAAUA,CAACA,WAAWA,CAACA,IAAIA,CAACA,CAACA;gBACjCA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,IAAIA,CAACA,SAASA,CAACA,IAAIA,CAACA,CAACA;gBACzBA,CAACA;YACLA,CAACA;YAEDL,yBAAyBA,EAAWA,EAAEA,UAA6BA;gBAC/DM,GAAGA,CAACA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,EAAEA,CAACA,iBAAiBA,EAAEA,CAACA,CAACA,GAAGA,EAAEA,GAAGA,GAAGA,GAAGA,CAACA,kBAAkBA,EAAEA,CAACA;oBACvEA,EAAEA,CAACA,CAACA,oBAAeA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA;wBACvBA,UAAUA,CAACA,IAAIA,CAACA,IAAIA,CAACA,gBAAgBA,CAACA,GAAGA,CAACA,CAACA,CAACA;oBAChDA,CAACA;oBAACA,IAAIA,CAACA,CAACA;wBACJA,eAAeA,CAACA,GAAGA,EAAEA,UAAUA,CAACA,CAACA;oBACrCA,CAACA;gBACLA,CAACA;YACLA,CAACA;YAEDN,4BAA4BA,OAA4BA,EAAEA,UAA6BA,EAAEA,cAAiCA;gBACtHO,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,OAAOA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACtCA,IAAIA,MAAMA,GAAGA,OAAOA,CAACA,CAACA,CAACA,CAACA;oBACxBA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA,gBAAgBA,CAACA,MAAMA,CAACA,MAAMA,CAACA,CAACA;oBAChDA,IAAIA,MAAMA,GAAGA,UAAUA,CAACA,eAAeA,CAACA,MAAMA,CAACA,MAAMA,EAAEA,IAAIA,EAAEA,MAAMA,CAACA,QAAQA,CAACA,CAACA;oBAC9EA,EAAEA,CAACA,CAACA,MAAMA,KAAKA,IAAIA,CAACA,CAACA,CAACA;wBAElBA,WAAWA,CAACA,IAAIA,EAAEA,MAAMA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;oBAC1DA,CAACA;oBAACA,IAAIA,CAACA,EAAEA,CAACA,CAACA,CAACA,MAAMA,CAACA,CAACA,CAACA;wBAEjBA,UAAUA,CAACA,MAAMA,CAACA,MAAMA,EAAEA,IAAIA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;oBAChEA,CAACA;gBACLA,CAACA;YACLA,CAACA;YAEDP,qBAAqBA,OAAwBA,EAAEA,OAAwBA,EAAEA,UAA6BA,EAAEA,cAAiCA;gBACrIQ,IAAIA,GAAGA,GAAGA,IAAIA,CAACA,WAAWA,CAACA,OAAOA,EAAEA,OAAOA,CAACA,CAACA;gBAC7CA,EAAEA,CAACA,CAACA,CAACA,GAAGA,CAACA;oBACLA,MAAMA,CAACA;gBAGXA,IAAIA,UAAUA,GAAGA,OAAOA,CAACA,IAAIA,CAACA,MAAMA,CAACA;gBACrCA,EAAEA,CAACA,CAACA,UAAUA,YAAYA,YAAKA,CAACA,CAACA,CAACA;oBAC9BA,IAAIA,KAAKA,GAAGA,UAAUA,CAACA,YAAYA,CAACA,OAAOA,CAACA,CAACA;oBAC7CA,UAAUA,CAACA,WAAWA,CAACA,OAAOA,CAACA,CAACA;oBAChCA,UAAUA,CAACA,WAAWA,CAACA,OAAOA,EAAEA,KAAKA,CAACA,CAACA;gBAC3CA,CAACA;gBAACA,IAAIA,CAACA,EAAEA,CAACA,CAACA,CAACA,UAAUA,CAACA,CAACA,CAACA;oBACrBA,cAAcA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAACA;oBAC7BA,UAAUA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAACA;gBAC7BA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,OAAOA,CAACA,SAASA,CAACA,IAAIA,CAACA,CAACA;oBACxBA,OAAOA,CAACA,SAASA,CAACA,UAAUA,CAACA,CAACA;gBAClCA,CAACA;gBAGDA,EAAEA,CAACA,CAACA,OAAOA,YAAYA,YAAKA,CAACA,CAACA,CAACA;oBAC3BA,GAAGA,CAACA,CAACA,GAAGA,CAACA,MAAMA,GAAGA,OAAOA,CAACA,IAAIA,CAACA,IAAIA,EAAEA,EAAEA,MAAMA,CAACA,IAAIA,EAAEA,GAAGA,CAACA;wBACpDA,OAAOA,CAACA,WAAWA,CAACA,MAAMA,CAACA,OAAOA,CAACA,CAACA;oBACxCA,CAACA;oBACDA,EAAEA,CAACA,CAACA,OAAOA,YAAYA,YAAKA,CAACA;wBACzBA,OAAOA,CAACA,IAAIA,CAACA,QAAQA,CAACA,MAAMA,GAAGA,CAACA,CAACA;gBACzCA,CAACA;YACLA,CAACA;YAEDR,wBAAwBA,KAAgBA,EAAEA,UAA6BA,EAAEA,QAAwBA;gBAI7FS,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,KAAKA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACpCA,IAAIA,EAAEA,GAAGA,KAAKA,CAACA,CAACA,CAACA,CAACA;oBAClBA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA,gBAAgBA,CAACA,EAAEA,CAACA,CAACA;oBACrCA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA;wBACNA,QAAQA,CAACA;oBAEbA,IAAIA,UAAUA,GAAGA,CAACA,EAAEA,CAACA,aAAaA,GAAGA,IAAIA,CAACA,gBAAgBA,CAACA,EAAEA,CAACA,aAAaA,CAACA,GAAGA,IAAIA,CAACA,IAAIA,IAAIA,CAACA;oBAC7FA,EAAEA,CAACA,CAACA,UAAUA,YAAYA,YAAKA,CAACA,CAACA,CAACA;wBAG9BA,QAAQA,CAACA,GAAGA,CAACA,UAAUA,EAAEA,EAAEA,EAAEA,IAAIA,CAACA,CAACA;oBACvCA,CAACA;oBAACA,IAAIA,CAACA,CAACA;wBACJA,IAAIA,CAACA,SAASA,CAACA,UAAUA,CAACA,CAACA;oBAC/BA,CAACA;oBACDA,EAAEA,CAACA,CAACA,CAACA,IAAIA,CAACA,IAAIA,CAACA,MAAMA,CAACA,CAACA,CAACA;wBACpBA,UAAUA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA;oBAC1BA,CAACA;oBACDA,eAAeA,CAACA,EAAEA,EAAEA,IAAIA,EAAEA,QAAQA,CAACA,CAACA;gBACxCA,CAACA;YACLA,CAACA;YAEDT,yBAAyBA,QAAiBA,EAAEA,UAA2BA,EAAEA,QAAwBA;gBAC7FU,GAAGA,CAACA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,QAAQA,CAACA,iBAAiBA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,CAACA,GAAGA,EAAEA,GAAGA,GAAGA,GAAGA,CAACA,kBAAkBA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACzFA,IAAIA,OAAOA,GAAGA,IAAIA,CAACA,gBAAgBA,CAACA,GAAGA,CAACA,CAACA;oBACzCA,EAAEA,CAACA,CAACA,OAAOA,IAAIA,CAACA,OAAOA,CAACA,IAAIA,CAACA,MAAMA,CAACA,CAACA,CAACA;wBAClCA,EAAEA,CAACA,CAACA,UAAUA,YAAYA,YAAKA,CAACA,CAACA,CAACA;4BAC9BA,QAAQA,CAACA,GAAGA,CAACA,UAAUA,EAAEA,GAAGA,EAAEA,OAAOA,CAACA,CAACA;wBAC3CA,CAACA;wBAACA,IAAIA,CAACA,CAACA;4BACJA,OAAOA,CAACA,SAASA,CAACA,UAAUA,CAACA,CAACA;wBAClCA,CAACA;wBACDA,eAAeA,CAACA,GAAGA,EAAEA,OAAOA,EAAEA,QAAQA,CAACA,CAACA;oBAC5CA,CAACA;gBACLA,CAACA;YACLA,CAACA;YAWDV,gBAAgBA,KAAgBA,EAAEA,OAAkBA,EAAEA,QAAmBA,EAAEA,OAA4BA;gBACnGW,IAAIA,QAAQA,GAAGA,qBAAgBA,EAAEA,CAACA;gBAClCA,IAAIA,UAAUA,GAAsBA,EAAEA,CAACA;gBACvCA,IAAIA,cAAcA,GAAsBA,EAAEA,CAACA;gBAE3CA,WAAWA,CAACA,KAAKA,CAACA,CAACA;gBACnBA,cAAcA,CAACA,QAAQA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;gBACrDA,aAAaA,CAACA,OAAOA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;gBACnDA,kBAAkBA,CAACA,OAAOA,EAAEA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;gBACxDA,cAAcA,CAACA,KAAKA,EAAEA,UAAUA,EAAEA,QAAQA,CAACA,CAACA;gBAE5CA,QAAQA,CAACA,MAAMA,EAAEA,CAACA;gBAClBA,QAAQA,CAACA,MAAMA,CAACA,UAAUA,EAAEA,cAAcA,CAACA,CAACA;YAChDA,CAACA;YAEDX;gBACIY,IAAIA,KAAKA,GAAcA,EAAEA,CAACA;gBAC1BA,IAAIA,CAAUA,MAAMA,EAAEA,KAAKA,EAAEA,KAAKA,CAACA,CAACA;gBACpCA,MAAMA,CAACA,KAAKA,EAAEA,EAAEA,EAAEA,EAAEA,EAAEA,EAAEA,CAACA,CAACA;YAC9BA,CAACA;YAEDZ,cAAcA,EAAWA,EAAEA,KAAgBA,EAAEA,cAAuBA;gBAChEa,IAAIA,QAAQA,GAAGA,oBAAeA,CAACA,EAAEA,CAACA,CAACA;gBACnCA,EAAEA,CAACA,CAACA,QAAQA,IAAIA,CAACA,cAAcA,CAACA;oBAC5BA,KAAKA,CAACA,IAAIA,CAACA,EAAEA,CAACA,CAACA;gBACnBA,GAAGA,CAACA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,EAAEA,CAACA,iBAAiBA,EAAEA,CAACA,CAACA,GAAGA,EAAEA,GAAGA,GAAGA,GAAGA,CAACA,kBAAkBA,EAAEA,CAACA;oBACvEA,IAAIA,CAACA,GAAGA,EAAEA,KAAKA,EAAEA,QAAQA,CAACA,CAACA;gBAC/BA,CAACA;YACLA,CAACA;YAEDb,IAAIA,OAAOA,GAAGA,kBAAaA,CAACA,MAAMA,EAAEA,MAAMA,CAACA,CAACA;YAC5CA,MAAMA,CAACA;gBACHA,KAAKA,YAACA,UAAmBA;oBACrBc,EAAEA,CAACA,CAACA,UAAUA,CAACA;wBACXA,IAAIA,EAAEA,CAACA;oBACXA,OAAOA,CAACA,KAAKA,EAAEA,CAACA;gBACpBA,CAACA;gBACDd,IAAIA;oBACAe,OAAOA,CAACA,IAAIA,EAAEA,CAACA;gBACnBA,CAACA;aACJf,CAACA;QACNA,CAACA;QArNe1C,wBAAmBA,sBAqNlCA,CAAAA;IACLA,CAACA,EAlOgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QAkOpBA;AAADA,CAACA,EAlOS,MAAM,KAAN,MAAM,QAkOf;AClOD,IAAU,MAAM,CAmFf;AAnFD,WAAU,MAAM;IAACA,IAAAA,IAAIA,CAmFpBA;IAnFgBA,WAAAA,IAAIA,EAACA,CAACA;QAWnBC,IAAIA,KAAKA,GAAGA,sCAAsCA,CAACA;QAkBnDA;YACI0D,IAAIA,QAAQA,GAAiBA,EAAEA,CAACA;YAChCA,IAAIA,KAAKA,GAAoBA,EAAEA,CAACA;YAChCA,IAAIA,OAAOA,GAAGA,CAACA,CAACA;YAEhBA,MAAMA,CAACA;gBACHA,GAAGA,YAACA,EAAWA,EAAEA,IAAqBA;oBAClCC,OAAOA,EAAEA,CAACA;oBACVA,IAAIA,GAAGA,GAAGA,OAAOA,CAACA,QAAQA,EAAEA,CAACA;oBAC7BA,EAAEA,CAACA,cAAcA,CAACA,KAAKA,EAAEA,KAAKA,EAAEA,GAAGA,CAACA,CAACA;oBACrCA,IAAIA,CAACA,WAAWA,CAACA,YAAYA,EAAEA,GAAGA,CAACA,CAACA;oBACpCA,QAAQA,CAACA,GAAGA,CAACA,GAAGA,EAAEA,CAACA;oBACnBA,KAAKA,CAACA,GAAGA,CAACA,GAAGA,IAAIA,CAACA;oBAClBA,MAAMA,CAACA,GAAGA,CAACA;gBACfA,CAACA;gBACDD,WAAWA,YAACA,OAAwBA,EAAEA,OAAwBA;oBAC1DE,IAAIA,GAAGA,GAAGA,OAAOA,CAACA,WAAWA,CAACA,YAAYA,CAACA,CAACA;oBAC5CA,EAAEA,CAACA,CAACA,KAAKA,CAACA,GAAGA,CAACA,KAAKA,OAAOA,CAACA,CAACA,CAACA;wBACzBA,OAAOA,CAACA,WAAWA,CAACA,YAAYA,EAAEA,SAASA,CAACA,CAACA;wBAC7CA,OAAOA,CAACA,WAAWA,CAACA,YAAYA,EAAEA,GAAGA,CAACA,CAACA;wBACvCA,KAAKA,CAACA,GAAGA,CAACA,GAAGA,OAAOA,CAACA;wBACrBA,MAAMA,CAACA,GAAGA,CAACA;oBACfA,CAACA;oBACDA,MAAMA,CAACA,EAAEA,CAACA;gBACdA,CAACA;gBACDF,aAAaA,YAACA,EAAWA;oBACrBG,IAAIA,GAAGA,GAAGA,EAAEA,CAACA,cAAcA,CAACA,KAAKA,EAAEA,KAAKA,CAACA,CAACA;oBAC1CA,IAAIA,IAAIA,GAAGA,CAACA,GAAGA,GAAGA,IAAIA,GAAGA,KAAKA,CAACA,GAAGA,CAACA,CAACA;oBACpCA,EAAEA,CAACA,iBAAiBA,CAACA,KAAKA,EAAEA,KAAKA,CAACA,CAACA;oBACnCA,EAAEA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA;wBACPA,IAAIA,CAACA,WAAWA,CAACA,YAAYA,EAAEA,SAASA,CAACA,CAACA;wBAC1CA,OAAOA,QAAQA,CAACA,GAAGA,CAACA,CAACA;wBACrBA,OAAOA,KAAKA,CAACA,GAAGA,CAACA,CAACA;oBACtBA,CAACA;oBACDA,MAAMA,CAACA,IAAIA,CAACA;gBAChBA,CAACA;gBACDH,aAAaA,YAACA,EAAWA;oBACrBI,IAAIA,GAAGA,GAAGA,EAAEA,CAACA,cAAcA,CAACA,KAAKA,EAAEA,KAAKA,CAACA,CAACA;oBAC1CA,MAAMA,CAACA,QAAQA,CAACA,GAAGA,CAACA,KAAKA,EAAEA,CAACA;gBAChCA,CAACA;gBACDJ,gBAAgBA,YAACA,EAAWA;oBACxBK,IAAIA,GAAGA,GAAGA,EAAEA,CAACA,cAAcA,CAACA,KAAKA,EAAEA,KAAKA,CAACA,CAACA;oBAC1CA,MAAMA,CAACA,KAAKA,CAACA,GAAGA,CAACA,CAACA;gBACtBA,CAACA;gBACDL,gBAAgBA,YAACA,IAAqBA;oBAClCM,IAAIA,GAAGA,GAAGA,IAAIA,CAACA,WAAWA,CAACA,YAAYA,CAACA,CAACA;oBACzCA,MAAMA,CAACA,QAAQA,CAACA,GAAGA,CAACA,CAACA;gBACzBA,CAACA;aACJN,CAACA;QACNA,CAACA;QAjDe1D,mBAAcA,iBAiD7BA,CAAAA;QAEDA,oBAA2BA,IAAqBA;YAC5CiE,MAAMA,CAACA,IAAIA,CAACA,WAAWA,CAACA,YAAYA,CAACA,CAACA;QAC1CA,CAACA;QAFejE,eAAUA,aAEzBA,CAAAA;IACLA,CAACA,EAnFgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QAmFpBA;AAADA,CAACA,EAnFS,MAAM,KAAN,MAAM,QAmFf","file":"mirage-html.js","sourcesContent":["module mirage.html {\r\n    export var version = '0.1.0';\r\n}\r\n","namespace mirage.html {\n    export interface IAnimClock {\n        enable();\n        disable();\n    }\n\n    export interface IAnimFrame {\n        (now: number, delta: number): void;\n    }\n\n    export function NewAnimClock(onFrame: IAnimFrame): IAnimClock {\n        let enabled = false;\n        let last = NaN;\n\n        function tick(now: number) {\n            if (!enabled)\n                return;\n            onFrame(now, isNaN(last) ? 0 : now - last);\n            last = now;\n            if (enabled)\n                window.requestAnimationFrame(tick);\n        }\n\n        return {\n            enable() {\n                enabled = true;\n                window.requestAnimationFrame(tick);\n            },\n            disable() {\n                enabled = false;\n                last = NaN;\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The Binder binds a single mirage tree to a single DOM render tree.\n     Each DOM element tagged as mirage with a parent not marked as mirage will start a new binder.\n     This binding is a bidirectional communication channel.\n     - The render tree provides layout inputs and primitive measurements.\n     - The layout tree provides resulting slots (x, y, width, height) to place the absolute render elements.\n     */\n\n    export interface IBinder {\n        getRoot(): core.LayoutNode;\n        setRoot(node: core.LayoutNode);\n        run();\n    }\n\n    export function NewBinder(tree: ITreeTracker): IBinder {\n        let root: core.LayoutNode;\n        let element: HTMLElement;\n        let drafter: mirage.draft.IDrafter;\n        let updater: mirage.draft.IDraftUpdater = NewDraftUpdater(tree);\n        let lastDraftSize = new Size(NaN, NaN);\n\n        function getRootSize(): ISize {\n            let htmlHeight = root.getAttached(\"html.height\");\n            if (htmlHeight === \"window\")\n                return new Size(window.innerWidth, window.innerHeight - 20);\n            return new Size(element.scrollWidth, element.scrollHeight);\n        }\n\n        return {\n            getRoot(): core.LayoutNode {\n                return root;\n            },\n            setRoot(node: core.LayoutNode) {\n                Size.undef(lastDraftSize);\n                root = node;\n                if (!node) {\n                    element = null;\n                    drafter = null;\n                } else {\n                    element = <HTMLElement>tree.getElementByNode(root);\n                    drafter = draft.NewDrafter(root);\n                }\n            },\n            run() {\n                let rootSize = getRootSize();\n                if (!Size.isEqual(lastDraftSize, rootSize)) {\n                    root.invalidateMeasure();\n                    Size.copyTo(rootSize, lastDraftSize);\n                }\n                if ((root.state.flags & mirage.core.LayoutFlags.hints) > 0) {\n                    drafter(updater, rootSize);\n                }\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The Binder Registry is intended to track all Binders.\n     This is a singleton and will track all binders.\n     Additionally, it will adjust registered binders after a structural tree change.\n     */\n\n    export interface IBinderRegistry {\n        update(addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]);\n    }\n\n    export function NewBinderRegistry(tree: ITreeTracker, binders?: IBinder[]): IBinderRegistry {\n        let roots: core.LayoutNode[] = [];\n        binders = binders || [];\n\n        function hoist(addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            // Hoist binders to the root\n            // This is done to ensure that a binder is the true root\n            // as a root may be slipped above an existing binder root\n            // Added roots will be stripped of hoisted roots from existing binders\n            for (var i = 0; i < binders.length; i++) {\n                let binder = binders[i];\n                let curRoot = binder.getRoot();\n                if (!curRoot) {\n                    // Dead binder, destroy it\n                    binders.splice(i, 1);\n                    i--;\n                    continue;\n                }\n                let newRoot = findRoot(curRoot);\n                if (curRoot !== newRoot) {\n                    replaceBinderRoot(binder, curRoot, newRoot, destroyedRoots);\n                }\n\n                // If this binder was taken over by newRoot and exists in addedRoots,\n                // we should remove so a duplicate binder isn't created\n                let existingIndex = addedRoots.indexOf(newRoot);\n                if (existingIndex > -1)\n                    addedRoots.splice(i, 1);\n            }\n        }\n\n        function findRoot(curRoot: core.LayoutNode): core.LayoutNode {\n            let newRoot = curRoot;\n            while (newRoot.tree.parent) {\n                newRoot = newRoot.tree.parent;\n            }\n            return newRoot;\n        }\n\n        function replaceBinderRoot(binder: IBinder, curRoot: core.LayoutNode, newRoot: core.LayoutNode, destroyedRoots: core.LayoutNode[]) {\n            // Replace this binder's root with newRoot\n\n            // If newRoot already has a binder, this binder should be destroyed\n            if (roots.indexOf(newRoot) > -1) {\n                destroyedRoots.push(curRoot);\n                return;\n            }\n\n            // stop tracking current root\n            let oldIndex = roots.indexOf(curRoot);\n            if (oldIndex > -1)\n                roots.splice(oldIndex, 1);\n\n            binder.setRoot(newRoot);\n            roots.push(newRoot);\n        }\n\n        function create(nodes: core.LayoutNode[]) {\n            for (var i = 0; i < nodes.length; i++) {\n                let node = nodes[i];\n                let binder = NewBinder(tree);\n                binder.setRoot(node);\n                roots.push(node);\n                binders.push(binder);\n            }\n        }\n\n        function destroy(destroyedRoots: core.LayoutNode[]) {\n            for (var i = 0; i < binders.length; i++) {\n                let index = destroyedRoots.indexOf(binders[i].getRoot());\n                if (index > -1) {\n                    destroyBinder(index);\n                    i--;\n                }\n            }\n        }\n\n        function destroyBinder(index: number) {\n            let binder = binders.splice(index, 1)[0];\n            let curRoot = binder.getRoot();\n            binder.setRoot(null);\n            if (curRoot) {\n                // Stop tracking this root as bound\n                let trackIndex = roots.indexOf(curRoot);\n                if (trackIndex > -1)\n                    roots.splice(trackIndex, 1);\n            }\n        }\n\n        return {\n            update(addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n                hoist(addedRoots, destroyedRoots);\n                create(addedRoots);\n                destroy(destroyedRoots);\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The DOM Monitor is intended to watch the entire DOM and filter for mirage-tagged elements.\n     It will report nodes added and removed as a result of DOM tree and attribute changes.\n     For instance, if someone deletes the `data-layout` attribute from a DOM element, it will be reported as removed.\n     */\n\n    export interface IDOMMonitor {\n        start();\n        stop();\n    }\n\n    export interface INodeMonitorUpdate {\n        (added: Element[], removed: Element[], untagged: Element[], changed: IDataLayoutChange[]): void;\n    }\n\n    export interface IDataLayoutChange {\n        target: Element;\n        oldValue: string;\n    }\n\n    export function isMirageElement(node: Node): boolean {\n        // Only consider element nodes\n        // Only consider nodes with 'data-layout'\n        // Attribute monitor will pick up added/removed attribute\n        return node.nodeType === node.ELEMENT_NODE\n            && !!(<Element>node).getAttribute(\"data-layout\");\n    }\n\n    export function NewDOMMonitor(target: Node, onUpdate: INodeMonitorUpdate): IDOMMonitor {\n        var observer = new MutationObserver(mutations => {\n            var added: Element[] = [];\n            var removed: Element[] = [];\n            var untagged: Element[] = [];\n            var changed: IDataLayoutChange[] = [];\n\n            let needsUpdate = false;\n            for (var i = 0; i < mutations.length; i++) {\n                let mutation = mutations[i];\n                if (mutation.type === \"childList\") {\n                    for (var j = 0; j < mutation.addedNodes.length; j++) {\n                        let el = mutation.addedNodes[j];\n                        if (isMirageElement(el)) {\n                            added.push(<Element>el);\n                            needsUpdate = true;\n                        }\n                    }\n                    for (var j = 0; j < mutation.removedNodes.length; j++) {\n                        let el = mutation.removedNodes[j];\n                        if (isMirageElement(el)) {\n                            removed.push(<Element>el);\n                            needsUpdate = true;\n                        }\n                    }\n                } else if (mutation.type === \"attributes\") {\n                    if (!mutation.oldValue) {\n                        if (isMirageElement(mutation.target)) {\n                            // 'data-layout' attribute added\n                            added.push(<Element>mutation.target);\n                            needsUpdate = true;\n                        }\n                    } else {\n                        if (!isMirageElement(mutation.target)) {\n                            // 'data-layout' attribute removed\n                            untagged.push(<Element>mutation.target);\n                            needsUpdate = true;\n                        } else {\n                            // 'data-layout' attribute changed\n                            changed.push({target: <Element>mutation.target, oldValue: mutation.oldValue});\n                            needsUpdate = true;\n                        }\n                    }\n                }\n            }\n\n            if (needsUpdate) {\n                onUpdate(added, removed, untagged, changed);\n            }\n        });\n\n        return {\n            start() {\n                observer.observe(target, {\n                    childList: true,\n                    subtree: true,\n                    attributes: true,\n                    attributeOldValue: true,\n                    attributeFilter: [\"data-layout\"],\n                });\n            },\n            stop() {\n                observer.disconnect();\n            },\n        };\n    }\n}","namespace mirage.html {\n    export function NewDraftUpdater(tree: ITreeTracker): mirage.draft.IDraftUpdater {\n        function updateSlot(el: HTMLElement, slot: IRect) {\n            el.style.position = \"absolute\";\n            el.style.left = `${slot.x}px`;\n            el.style.top = `${slot.y}px`;\n            el.style.width = `${slot.width}px`;\n            el.style.height = `${slot.height}px`;\n        }\n\n        return {\n            updateSlots(updates: draft.ISlotUpdate[]) {\n                for (var i = 0; i < updates.length; i++) {\n                    let update = updates[i];\n                    let node = update.node;\n                    if (!node.tree.parent)\n                        continue;\n                    updateSlot(<HTMLElement>tree.getElementByNode(update.node), update.newRect);\n                }\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The Element Translator translates the data-layout attribute into a layout node\n     If it is detected that \"type\" changed during a data-layout change,\n     a new filled layout node will be returned, but not replaced in the layout tree\n     During any translation, if null is returned, the node should be destroyed\n     */\n\n    export interface IElementTranslator {\n        translateNew(el: Element): core.LayoutNode;\n        translateChange(el: Element, node: core.LayoutNode, oldDataLayout: string): core.LayoutNode;\n    }\n    interface IDataLayoutHash {\n        [property: string]: string;\n    }\n    export function NewElementTranslator(): IElementTranslator {\n        function parseDataLayout(dataLayout: string): IDataLayoutHash {\n            let hash: IDataLayoutHash = {};\n            for (let tokens = dataLayout.split(\";\"), i = 0; i < tokens.length; i++) {\n                let token = tokens[i];\n                let index = token.indexOf(':');\n                if (index < 0)\n                    continue;\n                hash[token.substr(0, index).trim()] = token.substr(index + 1).trim();\n            }\n            return hash;\n        }\n\n        function applyHash(node: core.LayoutNode, hash: IDataLayoutHash) {\n            for (let keys = Object.keys(hash), i = 0; i < keys.length; i++) {\n                let key = keys[i];\n                let mapper = mirage.map.getMapper(key);\n                if (mapper)\n                    mapper(node, hash[key]);\n            }\n        }\n\n        return {\n            translateNew(el: Element): core.LayoutNode {\n                let hash = parseDataLayout(el.getAttribute(\"data-layout\"));\n                let type = hash[\"type\"];\n                if (!type)\n                    return null;\n                let node = mirage.createNodeByType(type);\n                applyHash(node, hash);\n                return node;\n            },\n            translateChange(el: Element, node: core.LayoutNode, oldDataLayout: string): core.LayoutNode {\n                let oldHash = parseDataLayout(oldDataLayout);\n                let newHash = parseDataLayout(el.getAttribute(\"data-layout\"));\n                let newType = newHash[\"type\"];\n                if (!newType)\n                    return null;\n                if (oldHash[\"type\"] !== newType) {\n                    let newNode = mirage.createNodeByType(newType);\n                    applyHash(newNode, newHash);\n                    return newNode;\n                }\n\n                // Unset values that exist in old, but not in new\n                let oldKeys = Object.keys(oldHash);\n                let newKeys = Object.keys(newHash);\n                for (let i = 0; i < oldKeys.length; i++) {\n                    let key = oldKeys[i];\n                    if (newKeys.indexOf(key) > -1)\n                        continue;\n                    let mapper = mirage.map.getMapper(key);\n                    if (mapper)\n                        mapper(node, undefined);\n                }\n\n                applyHash(node, newHash);\n                return node;\n            },\n        };\n    }\n}","namespace mirage {\n    var orchestrator: html.IOrchestrator;\n\n    export function watchDOM(target?: Node) {\n        target = target || document.body;\n        orchestrator = html.NewOrchestrator(target);\n        orchestrator.start();\n    }\n\n    export function getRoots(): core.LayoutNode[] {\n        return orchestrator.binders.map(binder => binder.getRoot());\n    }\n\n    export function getLayoutNode(obj: Element | string): core.LayoutNode {\n        let el: Element;\n        if (typeof obj === \"string\") {\n            el = document.getElementById(obj);\n        } else {\n            el = obj;\n        }\n        return el ? orchestrator.tree.getNodeByElement(el) : null;\n    }\n\n    export function dumpLayoutTree(root: core.LayoutNode, indent?: string): string {\n        let s = \"\";\n        if (!indent) {\n            s += \"\\n\";\n            indent = \"\";\n        }\n        let ctor = root.constructor;\n        s += indent + (<any>ctor).name.toString() + \"\\n\";\n        for (let walker = root.tree.walk(); walker.step();) {\n            s += dumpLayoutTree(walker.current, indent + \"  \");\n        }\n        return s;\n    }\n\n    export function enableConsoleLogger() {\n        mirage.logger = mirage.logging.NewConsoleLogger(node => {\n            let el = orchestrator.tree.getElementByNode(node);\n            let id = el && el.id ? `#${el.id}` : \"\";\n            let type = <any>node.constructor;\n            return `${type.name}${id}`;\n        });\n    }\n}","namespace mirage.html {\n    export interface IOrchestrator {\n        tree: ITreeTracker;\n        binders: IBinder[];\n        registry: IBinderRegistry;\n        sync: ITreeSynchronizer;\n        start();\n        stop();\n    }\n\n    export function NewOrchestrator(target: Node): IOrchestrator {\n        let tree = NewTreeTracker();\n        let binders: IBinder[] = [];\n        let registry = NewBinderRegistry(tree, binders);\n        let sync = NewTreeSynchronizer(target, tree, registry);\n        let clock = NewAnimClock(onFrame);\n\n        function onFrame(now: number, delta: number) {\n            for (let i = 0; i < binders.length; i++) {\n                binders[i].run();\n            }\n        }\n\n        return {\n            tree: tree,\n            binders: binders,\n            registry: registry,\n            sync: sync,\n            start() {\n                sync.start(true);\n                clock.enable();\n            },\n            stop() {\n                clock.disable();\n                sync.stop();\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     When running tree synchronization, child nodes can appear out of order\n     The Panel Inserter will track items in escrow\n     When ready to commit, each item will be inserted into the proper index\n     */\n\n    export interface IPanelInserter {\n        add(panel: Panel, el: Element, node: core.LayoutNode);\n        commit();\n    }\n\n    interface IPanelInsertItem {\n        panel: Panel;\n        entries: IPanelInsertItemEntry[];\n    }\n    interface IPanelInsertItemEntry {\n        node: core.LayoutNode;\n        index: number;\n    }\n\n    export function NewPanelInserter(): IPanelInserter {\n        var items: IPanelInsertItem[] = [];\n\n        return {\n            add(panel: Panel, el: Element, node: core.LayoutNode) {\n                let item = panel.getAttached(\"html-sync-escrow\");\n                if (!item) {\n                    item = {\n                        panel: panel,\n                        entries: [],\n                    };\n                    panel.setAttached(\"html-sync-escrow\", item);\n                    items.push(item);\n                }\n\n                item.entries.push({\n                    node: node,\n                    index: Array.prototype.indexOf.call(el.parentElement.children, el),\n                });\n            },\n            commit() {\n                for (var i = 0; i < items.length; i++) {\n                    let item = items[i];\n                    let panel = item.panel;\n                    let entries = item.entries;\n                    panel.setAttached(\"html-sync-escrow\", undefined);\n                    entries.sort((a, b) => a.index - b.index);\n                    let inserted: core.LayoutNode[] = [];\n                    for (var j = 0; j < entries.length; j++) {\n                        let entry = entries[j];\n                        // deduplicate entries\n                        if (inserted.indexOf(entry.node) > -1)\n                            continue;\n                        inserted.push(entry.node);\n                        panel.insertChild(entry.node, entry.index);\n                    }\n                }\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The Tree Synchronizer tracks added/removed DOM elements.\n     It is responsible for synchronizing the render tree with the layout tree.\n     It also detects mirage roots and builds binders.\n     */\n\n    export interface ITreeSynchronizer {\n        start(initialize: boolean);\n        stop();\n    }\n\n    export function NewTreeSynchronizer(target: Node, tree?: ITreeTracker, registry?: IBinderRegistry, translator?: IElementTranslator): ITreeSynchronizer {\n        tree = tree || NewTreeTracker();\n        registry = registry || NewBinderRegistry(tree);\n        translator = translator || NewElementTranslator();\n\n        function mirrorAdded(added: Element[]) {\n            // Mirror new render elements to layout tree\n            for (var i = 0; i < added.length; i++) {\n                register(added[i]);\n            }\n        }\n\n        function mirrorUntagged(untagged: Element[], addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            // Mirror nodes that have been untagged, but remain in DOM\n            for (var i = 0; i < untagged.length; i++) {\n                deregister(untagged[i], true, addedRoots, destroyedRoots);\n            }\n        }\n\n        function mirrorRemoved(removed: Element[], addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            // Mirror old render elements from layout tree\n            // Adds nodes to addedRoots that were orphaned by destroying a root\n            // Adds nodes to destroyedRoots that were destroyed mirage parents\n            for (var i = 0; i < removed.length; i++) {\n                deregister(removed[i], false, addedRoots, destroyedRoots);\n            }\n        }\n\n        function register(el: Element) {\n            if (tree.elementExists(el) || !isMirageElement(el))\n                return;\n            // The parent may not be mirrored in the layout tree yet\n            // We will set parent after all adds/removes have completed\n            let node = translator.translateNew(el);\n            if (!node) {\n                // we could not detect node, it will not be created\n                return;\n            }\n            tree.add(el, node);\n\n            // register children\n            for (let cur = el.firstElementChild; !!cur; cur = cur.nextElementSibling) {\n                register(cur);\n            }\n        }\n\n        function deregister(el: Element, isUntagged: boolean, addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            let node = tree.removeElement(el);\n            if (!node)\n                return;\n            if (!isUntagged) {\n                // deregister children\n                for (let cur = el.firstElementChild; !!cur; cur = cur.nextElementSibling) {\n                    deregister(cur, true, null, null);\n                }\n            }\n\n            let parentNode = node.tree.parent;\n            if (!parentNode) {\n                destroyedRoots.push(node);\n                promoteChildren(el, addedRoots);\n            }\n\n            if (parentNode instanceof Panel) {\n                parentNode.removeChild(node);\n            } else {\n                node.setParent(null);\n            }\n        }\n\n        function promoteChildren(el: Element, addedRoots: core.LayoutNode[]) {\n            for (let cur = el.firstElementChild; !!cur; cur = cur.nextElementSibling) {\n                if (isMirageElement(cur)) {\n                    addedRoots.push(tree.getNodeByElement(cur));\n                } else {\n                    promoteChildren(cur, addedRoots);\n                }\n            }\n        }\n\n        function mirrorTranslations(changes: IDataLayoutChange[], addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            for (let i = 0; i < changes.length; i++) {\n                let change = changes[i];\n                let node = tree.getNodeByElement(change.target);\n                let result = translator.translateChange(change.target, node, change.oldValue);\n                if (result !== node) {\n                    // destroy old node, rehook parent/children to new node\n                    replaceNode(node, result, addedRoots, destroyedRoots);\n                } else if (!result) {\n                    // destroy this node, deregister will also hoist children properly\n                    deregister(change.target, true, addedRoots, destroyedRoots);\n                }\n            }\n        }\n\n        function replaceNode(oldNode: core.LayoutNode, newNode: core.LayoutNode, addedRoots: core.LayoutNode[], destroyedRoots: core.LayoutNode[]) {\n            let uid = tree.replaceNode(oldNode, newNode);\n            if (!uid) // old node does not exist, what should we do?\n                return;\n\n            // Adjust parent's children\n            let parentNode = oldNode.tree.parent;\n            if (parentNode instanceof Panel) {\n                let index = parentNode.indexOfChild(oldNode);\n                parentNode.removeChild(oldNode);\n                parentNode.insertChild(newNode, index);\n            } else if (!parentNode) {\n                destroyedRoots.push(oldNode);\n                addedRoots.push(newNode);\n            } else {\n                oldNode.setParent(null);\n                newNode.setParent(parentNode);\n            }\n\n            // Migrate old children to new node\n            if (newNode instanceof Panel) {\n                for (let walker = oldNode.tree.walk(); walker.step();) {\n                    newNode.appendChild(walker.current);\n                }\n                if (oldNode instanceof Panel)\n                    oldNode.tree.children.length = 0;\n            }\n        }\n\n        function mirrorAncestry(added: Element[], addedRoots: core.LayoutNode[], inserter: IPanelInserter) {\n            // Configure parents after all layout nodes have been created/destroyed\n            // This is done to ensure parent layout nodes exist\n            // Adds nodes to addedRoots that do not have mirage parents\n            for (var i = 0; i < added.length; i++) {\n                let el = added[i];\n                let node = tree.getNodeByElement(el);\n                if (!node)\n                    continue;\n                // coerce 'none' to null\n                let parentNode = (el.parentElement ? tree.getNodeByElement(el.parentElement) : null) || null;\n                if (parentNode instanceof Panel) {\n                    // To ensure proper ordering, we will collect all new children for each parent\n                    // We will insert the children in sorted order\n                    inserter.add(parentNode, el, node);\n                } else {\n                    node.setParent(parentNode);\n                }\n                if (!node.tree.parent) {\n                    addedRoots.push(node);\n                }\n                configAncestors(el, node, inserter);\n            }\n        }\n\n        function configAncestors(parentEl: Element, parentNode: core.LayoutNode, inserter: IPanelInserter) {\n            for (let cur = parentEl.firstElementChild, i = 0; !!cur; cur = cur.nextElementSibling, i++) {\n                let curNode = tree.getNodeByElement(cur);\n                if (curNode && !curNode.tree.parent) {\n                    if (parentNode instanceof Panel) {\n                        inserter.add(parentNode, cur, curNode);\n                    } else {\n                        curNode.setParent(parentNode);\n                    }\n                    configAncestors(cur, curNode, inserter);\n                }\n            }\n        }\n\n        /*\n         Each update, we need to\n         - construct new layout nodes mirroring new render elements\n         - detach layout nodes mirroring old render elements\n         - run data-layout translation changes\n         - configure all new layout nodes with parent\n         - hoist binders to the true root\n         - add binders for new root nodes\n         */\n        function update(added: Element[], removed: Element[], untagged: Element[], changed: IDataLayoutChange[]) {\n            let inserter = NewPanelInserter();\n            let addedRoots: core.LayoutNode[] = [];\n            let destroyedRoots: core.LayoutNode[] = [];\n\n            mirrorAdded(added);\n            mirrorUntagged(untagged, addedRoots, destroyedRoots);\n            mirrorRemoved(removed, addedRoots, destroyedRoots);\n            mirrorTranslations(changed, addedRoots, destroyedRoots);\n            mirrorAncestry(added, addedRoots, inserter);\n\n            inserter.commit();\n            registry.update(addedRoots, destroyedRoots);\n        }\n\n        function init() {\n            let added: Element[] = [];\n            scan(<Element>target, added, false);\n            update(added, [], [], []);\n        }\n\n        function scan(el: Element, added: Element[], parentIsMirage: boolean) {\n            let isMirage = isMirageElement(el);\n            if (isMirage && !parentIsMirage)\n                added.push(el);\n            for (let cur = el.firstElementChild; !!cur; cur = cur.nextElementSibling) {\n                scan(cur, added, isMirage);\n            }\n        }\n\n        var monitor = NewDOMMonitor(target, update);\n        return {\n            start(initialize: boolean) {\n                if (initialize)\n                    init();\n                monitor.start();\n            },\n            stop() {\n                monitor.stop();\n            },\n        };\n    }\n}","namespace mirage.html {\n    /*\n     The Tree Tracker tracks render elements (DOM) and layout nodes (mirage).\n     This is a singleton and tracks the entire DOM.\n     Instead of doing lookups using a synchronized double-array, we are tracking a uid on each object.\n     The render element and layout node can be retrieved by uid.\n     We use a DOM attribute ('http://schemas.wsick.com/mirage/html':uid)\n     and a layout node attached property ('mirage-uid') to track the uid.\n     This uid is a running int counter that is converted to a string to match attributes.\n     */\n\n    var XMLNS = \"http://schemas.wsick.com/mirage/html\";\n\n    export interface ITreeTracker {\n        add(el: Element, node: core.LayoutNode): string;\n        replaceNode(oldNode: core.LayoutNode, newNode: core.LayoutNode): string;\n        removeElement(el: Element): core.LayoutNode;\n        elementExists(el: Element): boolean;\n        getNodeByElement(el: Element): core.LayoutNode;\n        getElementByNode(node: core.LayoutNode): Element;\n    }\n\n    interface IElementHash {\n        [uid: string]: Element;\n    }\n    interface ILayoutNodeHash {\n        [uid: string]: core.LayoutNode;\n    }\n\n    export function NewTreeTracker(): ITreeTracker {\n        var elements: IElementHash = {};\n        var nodes: ILayoutNodeHash = {};\n        var lastUid = 0;\n\n        return {\n            add(el: Element, node: core.LayoutNode): string {\n                lastUid++;\n                var uid = lastUid.toString();\n                el.setAttributeNS(XMLNS, \"uid\", uid);\n                node.setAttached(\"mirage-uid\", uid);\n                elements[uid] = el;\n                nodes[uid] = node;\n                return uid;\n            },\n            replaceNode(oldNode: core.LayoutNode, newNode: core.LayoutNode): string {\n                let uid = oldNode.getAttached(\"mirage-uid\");\n                if (nodes[uid] === oldNode) {\n                    oldNode.setAttached(\"mirage-uid\", undefined);\n                    newNode.setAttached(\"mirage-uid\", uid);\n                    nodes[uid] = newNode;\n                    return uid;\n                }\n                return \"\";\n            },\n            removeElement(el: Element): core.LayoutNode {\n                var uid = el.getAttributeNS(XMLNS, \"uid\");\n                var node = !uid ? null : nodes[uid];\n                el.removeAttributeNS(XMLNS, \"uid\");\n                if (node) {\n                    node.setAttached(\"mirage-uid\", undefined);\n                    delete elements[uid];\n                    delete nodes[uid];\n                }\n                return node;\n            },\n            elementExists(el: Element): boolean {\n                var uid = el.getAttributeNS(XMLNS, \"uid\");\n                return elements[uid] === el;\n            },\n            getNodeByElement(el: Element): core.LayoutNode {\n                var uid = el.getAttributeNS(XMLNS, \"uid\");\n                return nodes[uid];\n            },\n            getElementByNode(node: core.LayoutNode): Element {\n                var uid = node.getAttached(\"mirage-uid\");\n                return elements[uid];\n            },\n        };\n    }\n\n    export function getNodeUid(node: core.LayoutNode): string {\n        return node.getAttached(\"mirage-uid\");\n    }\n}"],"sourceRoot":"/mirage-html/"}