{"version":3,"sources":["_version.ts","sync/IDOMMonitor.ts"],"names":["mirage","mirage.html","mirage.html.sync","mirage.html.sync.NewDOMMonitor","mirage.html.sync.NewDOMMonitor.nodeHasLayoutAttr","mirage.html.sync.NewDOMMonitor.addElement","mirage.html.sync.NewDOMMonitor.removeElement","mirage.html.sync.NewDOMMonitor.start","mirage.html.sync.NewDOMMonitor.stop"],"mappings":"AAAA,IAAO,MAAM,CAEZ;AAFD,WAAO,MAAM;IAACA,IAAAA,IAAIA,CAEjBA;IAFaA,WAAAA,IAAIA,EAACA,CAACA;QACLC,YAAOA,GAAGA,OAAOA,CAACA;IACjCA,CAACA,EAFaD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QAEjBA;AAADA,CAACA,EAFM,MAAM,KAAN,MAAM,QAEZ;ACFD,IAAU,MAAM,CA0Ef;AA1ED,WAAU,MAAM;IAACA,IAAAA,IAAIA,CA0EpBA;IA1EgBA,WAAAA,IAAIA;QAACC,IAAAA,IAAIA,CA0EzBA;QA1EqBA,WAAAA,IAAIA,EAACA,CAACA;YAMxBC,uBAA8BA,MAAYA,EAAEA,WAA+CA,EAAEA,aAAiDA;gBAC1IC,2BAA2BA,IAAUA;oBACjCC,MAAMA,CAACA,CAACA,CAAWA,IAAKA,CAACA,YAAYA,CAACA,aAAaA,CAACA,CAACA;gBACzDA,CAACA;gBAEDD,oBAAoBA,IAAUA,EAAEA,MAAYA;oBAExCE,EAAEA,CAACA,CAACA,IAAIA,CAACA,QAAQA,KAAKA,IAAIA,CAACA,YAAYA,CAACA;wBACpCA,MAAMA,CAACA;oBAGXA,EAAEA,CAACA,CAACA,CAACA,iBAAiBA,CAACA,IAAIA,CAACA,CAACA;wBACzBA,MAAMA,CAACA;oBACXA,WAAWA,CAACA,IAAIA,EAAEA,MAAMA,CAACA,CAACA;gBAC9BA,CAACA;gBAEDF,uBAAuBA,IAAUA,EAAEA,MAAYA;oBAE3CG,EAAEA,CAACA,CAACA,IAAIA,CAACA,QAAQA,KAAKA,IAAIA,CAACA,YAAYA,CAACA;wBACpCA,MAAMA,CAACA;oBAGXA,EAAEA,CAACA,CAACA,CAACA,iBAAiBA,CAACA,IAAIA,CAACA,CAACA;wBACzBA,MAAMA,CAACA;oBACXA,aAAaA,CAACA,IAAIA,EAAEA,MAAMA,CAACA,CAACA;gBAChCA,CAACA;gBAEDH,IAAIA,QAAQA,GAAGA,IAAIA,gBAAgBA,CAACA,UAAAA,SAASA;oBACzCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,SAASA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;wBACxCA,IAAIA,QAAQA,GAAGA,SAASA,CAACA,CAACA,CAACA,CAACA;wBAC5BA,EAAEA,CAACA,CAACA,QAAQA,CAACA,IAAIA,KAAKA,WAAWA,CAACA,CAACA,CAACA;4BAChCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,QAAQA,CAACA,UAAUA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gCAClDA,UAAUA,CAACA,QAAQA,CAACA,UAAUA,CAACA,CAACA,CAACA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,CAACA;4BACxDA,CAACA;4BACDA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,QAAQA,CAACA,YAAYA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gCACpDA,aAAaA,CAACA,QAAQA,CAACA,YAAYA,CAACA,CAACA,CAACA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,CAACA;4BAC7DA,CAACA;wBACLA,CAACA;wBAACA,IAAIA,CAACA,EAAEA,CAACA,CAACA,QAAQA,CAACA,IAAIA,KAAKA,YAAYA,CAACA,CAACA,CAACA;4BACxCA,EAAEA,CAACA,CAACA,CAACA,QAAQA,CAACA,QAAQA,CAACA,CAACA,CAACA;gCACrBA,EAAEA,CAACA,CAACA,iBAAiBA,CAACA,QAAQA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA;oCAErCA,UAAUA,CAACA,QAAQA,CAACA,MAAMA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,aAAaA,CAACA,CAACA;gCAC/DA,CAACA;4BACLA,CAACA;4BAACA,IAAIA,CAACA,CAACA;gCACJA,EAAEA,CAACA,CAACA,CAACA,iBAAiBA,CAACA,QAAQA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA;oCAEtCA,aAAaA,CAACA,QAAQA,CAACA,MAAMA,EAAEA,QAAQA,CAACA,MAAMA,CAACA,aAAaA,CAACA,CAACA;gCAClEA,CAACA;4BACLA,CAACA;wBACLA,CAACA;oBACLA,CAACA;gBACLA,CAACA,CAACA,CAACA;gBAEHA,MAAMA,CAACA;oBACHA,KAAKA;wBACDI,QAAQA,CAACA,OAAOA,CAACA,MAAMA,EAAEA;4BACrBA,SAASA,EAAEA,IAAIA;4BACfA,OAAOA,EAAEA,IAAIA;4BACbA,UAAUA,EAAEA,IAAIA;4BAChBA,iBAAiBA,EAAEA,IAAIA;4BACvBA,eAAeA,EAAEA,CAACA,aAAaA,CAACA;yBACnCA,CAACA,CAACA;oBACPA,CAACA;oBACDJ,IAAIA;wBACAK,QAAQA,CAACA,UAAUA,EAAEA,CAACA;oBAC1BA,CAACA;iBACJL,CAACA;YACNA,CAACA;YAnEeD,kBAAaA,gBAmE5BA,CAAAA;QACLA,CAACA,EA1EqBD,IAAIA,GAAJA,SAAIA,KAAJA,SAAIA,QA0EzBA;IAADA,CAACA,EA1EgBD,IAAIA,GAAJA,WAAIA,KAAJA,WAAIA,QA0EpBA;AAADA,CAACA,EA1ES,MAAM,KAAN,MAAM,QA0Ef","file":"mirage-html.js","sourcesContent":["module mirage.html {\r\n    export var version = '0.1.0';\r\n}\r\n","namespace mirage.html.sync {\n    export interface IDOMMonitor {\n        start();\n        stop();\n    }\n\n    export function NewDOMMonitor(target: Node, onNodeAdded: (node: Node, parent: Node) => void, onNodeRemoved: (node: Node, parent: Node) => void): IDOMMonitor {\n        function nodeHasLayoutAttr(node: Node): boolean {\n            return !!(<Element>node).getAttribute(\"data-layout\");\n        }\n\n        function addElement(node: Node, parent: Node) {\n            // Only consider element nodes\n            if (node.nodeType !== node.ELEMENT_NODE)\n                return;\n            // Only consider nodes with 'data-layout'\n            // Attribute monitor will pick up added nodes that add attr later\n            if (!nodeHasLayoutAttr(node))\n                return;\n            onNodeAdded(node, parent);\n        }\n\n        function removeElement(node: Node, parent: Node) {\n            // Only consider element nodes\n            if (node.nodeType !== node.ELEMENT_NODE)\n                return;\n            // Only consider nodes with 'data-layout'\n            // Attribute monitor will pick up removed nodes that previously remove attr\n            if (!nodeHasLayoutAttr(node))\n                return;\n            onNodeRemoved(node, parent);\n        }\n\n        var observer = new MutationObserver(mutations => {\n            for (var i = 0; i < mutations.length; i++) {\n                let mutation = mutations[i];\n                if (mutation.type === \"childList\") {\n                    for (var j = 0; j < mutation.addedNodes.length; j++) {\n                        addElement(mutation.addedNodes[j], mutation.target);\n                    }\n                    for (var j = 0; j < mutation.removedNodes.length; j++) {\n                        removeElement(mutation.removedNodes[j], mutation.target);\n                    }\n                } else if (mutation.type === \"attributes\") {\n                    if (!mutation.oldValue) {\n                        if (nodeHasLayoutAttr(mutation.target)) {\n                            // 'data-layout' attribute added\n                            addElement(mutation.target, mutation.target.parentElement);\n                        }\n                    } else {\n                        if (!nodeHasLayoutAttr(mutation.target)) {\n                            // 'data-layout' attribute removed\n                            removeElement(mutation.target, mutation.target.parentElement);\n                        }\n                    }\n                }\n            }\n        });\n\n        return {\n            start() {\n                observer.observe(target, {\n                    childList: true,\n                    subtree: true,\n                    attributes: true,\n                    attributeOldValue: true,\n                    attributeFilter: [\"data-layout\"],\n                });\n            },\n            stop() {\n                observer.disconnect();\n            },\n        };\n    }\n}"],"sourceRoot":"/mirage"}